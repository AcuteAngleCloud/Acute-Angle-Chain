<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>AcuteAngleChain: README</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="aac-logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AcuteAngleChain
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">README </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>AACIO supports two different elliptic curves for ECDSA &ndash; secp256k1 and secp256r1 (also called prime256v1). The benefit of the r1 curve is hardware support in many mobile devices such as iPhones or Android devices. This application demonstrates usage of the r1 curve in a hardware device via the Secure Enclave on recent MacBook Pros with the Touch <a class="el" href="struct_bar.html">Bar</a>. An r1 private key is stored on the Secure Enclave and is not visible to the host. This private key can then be used to sign SHA256 digests (which could be the hash of an AACIO transaction) via the Secure Enclave. For verification of proper operation, the application then allows verification of public key recovery in the AACIO code base.</p>
<h1>Building and Signing</h1>
<p>The application <code>applesedemo</code> will be built on macOS builds of the AACIO source tree. The APIs in use require macOS 10.12+ (and ought to function on iOS10+ as well). However, usage of the Secure Enclave requires that the application be signed with a Mac App Store (MAS) style signature &ndash; older Darwin style signatures are not sufficient. This strong signature requirement ensures that the application which generated a particular private key is the only application that can use the private key.</p>
<p>Signing <code>applesedemo</code> as a MAS style application is clumsy in our case for two reasons; 1) these signatures require packaging in an "app bundle" which doesn't fit well for command line applications, and 2) the desire to keep all build steps devoid of XCode usage.</p>
<p>The script <code>sign.sh</code> is included which generates an app bundle <code>applesedemo.app</code> and signs it. It must be run with the unsigned <code>applesedemo</code> in its current working directory. <a class="el" href="struct_three.html">Three</a> parameters are required:</p><ol type="1">
<li>The SHA1 thumbprint of the signing certificate to use</li>
</ol>
<ol type="1">
<li>The fully formed AppID of the signed application (teamID + bundleID)</li>
</ol>
<ol type="1">
<li>Path to the provisioning profile used for signing</li>
</ol>
<p>There is a commented out example in the CMakeLists.txt which shows how the script can be executed post-build automatically.</p>
<p>Once signed, you must execute the <code>applesedemo</code> that is bundled inside the app build, i.e. <code>applesedemo.app/Contents/MacOS/applesedemo</code>. There is a crude check to print an error if attempting to execute an unsigned <code>applesedemo</code> but it may not catch cases of an application that is invalidly signed. An application that is invalidly signed and attempts to use the Secure Enclave can experience some unhelpful error messages.</p>
<h2>Personal Signing</h2>
<p>If you have access to the Apple Developer Program it is possible to use the developer portal to download a provisioning profile and/or create a developer certificate if you do not already have one.</p>
<p>However, even without a Developer account it's possible to use any Apple ID to generate a development certificate and provisioning profile that can be used locally. Unfortunately, this process has to be done via XCode's automatic "managed" signing mechanism. You must create a new Cocoa App in XCode, assign a pertinent bundle identifier, and then select your "Personal Team" for the Team to use. XCode will then contact Apple's servers and generate a proper provisioning profile and certificate if you do not already have one. You may have to manually look at the profiles created in <code>~/Library/MobileDevice/Provisioning\ Profiles/</code> to find the proper one to use.</p>
<p>Remember that the TeamID plus the Bundle ID that you fill out in XCode gate access to the Secure Enclave. Changing either of these values will cause the application to be unable to see keys generated with previous values.</p>
<h1>Usage</h1>
<h2>Generate Private <a class="el" href="struct_key.html">Key</a></h2>
<p>First, create a private key inside of the secure enclave. This application supports creating the key in a few different manners (see <code>--help</code>) that control the level of security the key is protected with. In this example, the key will be created in a way that requires usage of a fingerprint when signing a digest (such a signing a transaction). </p><div class="fragment"><div class="line">$ applesedemo.app/Contents/MacOS/applesedemo --create-se-touch-only</div><div class="line">Successfully created</div><div class="line">public_key(AACR17iKCZrb1JqSjUncCbDGQenzSqyuNmPU8iUA15efNW5KD1iHd9x)</div></div><!-- fragment --><p> The public key for the private key is printed; note it somewhere. It is possible to ask the Secure Enclave to create multiple private keys and assign labels to them but this application only allows a single key at once. </p><h2>Create <a class="el" href="struct_a.html">A</a> Digest and Sign It</h2>
<p>AACIO uses SHA256 digests to sign transactions, create a simple SHA256 digest from a small string: </p><div class="fragment"><div class="line">$ echo &#39;Hello world!&#39; | shasum -a 256</div><div class="line">0ba904eae8773b70c75333db4de2f3ac45a8ad4ddba1b242f0b3cfc199391dd8  -</div></div><!-- fragment --><p> Now, ask the Secure Enclave to sign the digest with the private key only it knows about. The signature will not be generated until a valid fingerprint is used. </p><div class="fragment"><div class="line">$ applesedemo.app/Contents/MacOS/applesedemo --sign 0ba904eae8773b70c75333db4de2f3ac45a8ad4ddba1b242f0b3cfc199391dd8</div><div class="line">signature(AACR1Jx4sBidhFV6PSvS8hWbG5oh77HKud8xpkoHLvWaZVaBeWttRpyEjaGbPRVEKu3JePTyVjANmP4GKFtG2DAuB4MTVqsdC9W)</div></div><!-- fragment --> <h2><a class="el" href="struct_key.html">Key</a> Recovery</h2>
<p>Given the signature and digest, we must be able to correlate that with the public key that signed the digest. </p><div class="fragment"><div class="line">$ applesedemo.app/Contents/MacOS/applesedemo --recover 0ba904eae8773b70c75333db4de2f3ac45a8ad4ddba1b242f0b3cfc199391dd8 \</div><div class="line">     AACR1Jx4sBidhFV6PSvS8hWbG5oh77HKud8xpkoHLvWaZVaBeWttRpyEjaGbPRVEKu3JePTyVjANmP4GKFtG2DAuB4MTVqsdC9W</div><div class="line">public_key(AACR17iKCZrb1JqSjUncCbDGQenzSqyuNmPU8iUA15efNW5KD1iHd9x)</div></div><!-- fragment --><p> Indeed, the public key recovered from this digest and signature matches the public key from the key stored in the Secure Enclave. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
